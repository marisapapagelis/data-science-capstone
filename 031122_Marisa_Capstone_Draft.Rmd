---
title: "Data Science Capstone"
author: "Marisa Papagelis"
date: "03/11/2022"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

# Set up
## Initialize packages
```{r packages, warning = FALSE, message=FALSE}
library(ggplot2)
library(viridis)
library(grid)
library(gridExtra)
library(dplyr)
library(car) #recode function
#regression analyses
library(lme4)
#library(countreg) #for rootogram visualization of fit of a count regression
library(rsq) #for pseudo R^2 values for glm models
library(lmtest)
library(betareg)
library(reshape2) #changed to reshape2
#library(fastDummies)
#library(stargazer)
#library(RColorBrewer)
library(stringr)
library(pglm)
library(MASS)
```

## Load data
```{r data, warning = FALSE}
#Read-in Qualtrics survey responses
data_raw <- read.csv("./MaaS_survey/Car+Ownership+Valuation+Survey+-+Revised_July+3%2C+2020_10.45.csv", stringsAsFactors=FALSE,na.strings=c("","NA"))
data_gc <- filter(data_raw, gc==1)

#Remove additional "header" rows from Qualtrics data export
data_gc <- data_gc[3:nrow(data_gc),] 
data_gc$ResponseId_orig <- data_gc$ResponseId
data_gc$ResponseId <- as.factor(1:nrow(data_gc))
rownames(data_gc) <- 1:nrow(data_gc)
```

#Built Enviro data (not used in this study, but kept for data cleaning simplicity)
```{r builtenviro, warning = FALSE}
#Load in EmpBen/suburban/rural data 
RuralUrbanSuburban <- read.csv("./MaaS_survey/RuralUrbanSuburban_raw.csv", stringsAsFactors = FALSE, na.strings=c("","NA"))

#Creat dummy variables
RuralUrbanSuburban <- RuralUrbanSuburban %>% mutate(Urban = ifelse(Urban...Suburban...Rural=="U", 1, 0),
                                                    Suburban = ifelse(Urban...Suburban...Rural=="S", 1, 0),
                                                    Rural = ifelse(Urban...Suburban...Rural=="R", 1, 0))
#merge data
data_gc<- merge(data_gc, RuralUrbanSuburban, by.x=c('HomeZIP'),
      by.y=c('Zip'),
      all.x=TRUE)
```

# Sample Sociodemographics
```{r sociodem, warning=FALSE}
#Recode HHInc categories to quasi-continuous, numeric variable representing HH income in $1000
summary(as.factor(data_gc$HHInc))
data_gc$HHInc.num <- recode(data_gc$HHInc,
      "'Less than $10,000'=5; '$10,000 - $14,999'=12.5; '$15,000 - $24,999'=20;
       '$25,000 - $34,999'=30; '$35,000 - $49,999'=42.5; '$50,000 - $74,999'=62.5;
       '$75,000 - $99,999'=87.5; '$100,000 - $149,999'=125; '$150,000 - $199,999'=175;
       '$200,000 or more'=225")

data_gc <- data_gc %>% mutate(#very likely below poverty line: 'Less than $10,000'=5; '$10,000 - $14,999'=12.5; '$15,000 - $24,999'=20
                              HHInc_bin1 = ifelse(HHInc.num == 5 | HHInc.num == 12.5 | HHInc.num == 20, 1, 0), 
                              # '$25,000 - $34,999'=30; $35,000 - $49,999'=42.5;
                              HHInc_bin2 = ifelse(HHInc.num == 30 | HHInc.num == 42.5, 1, 0),
                              # '$50,000 - $74,999'=62.5; '$75,000 - $99,999'=87.5; 
                              HHInc_bin3 = ifelse(HHInc.num == 62.5 | HHInc.num == 87.5, 1, 0),
                              # '$100,000 - $149,999'=125; '$150,000 - $199,999'=175;
                              HHInc_bin4 = ifelse(HHInc.num == 125 | HHInc.num == 175, 1, 0),
                              #  '$200,000 or more'=225"
                              HHInc_bin5 = ifelse(HHInc.num == 225, 1, 0)
                              )

#How many cars does your household own?: {"Zero", "1 car", "2 cars", "3 or more cars"}
data_gc$HHCars <- recode(data_gc$HHCars, "'Zero'=0; '1 car'=1; '2 cars'=2; '3 or more cars'=3")

#How many people are there in your household?
data_gc$HHPers <- recode(data_gc$HHPers, "'1'=1; '2'=2; '3'=3; '4'=4; '5'=5; '6'=6; '7 or more'=7")

#how many working adults are there in your household?
data_gc$HHWkAdult <- recode(data_gc$HHWkAdult, "'0'=0; '1'=1; '2'=2; '3'=3; '4'=4")

#recode RHUse_Typical
data_gc$RHUse_Typical <- recode(data_gc$RHUse_Typical, "'Zero times' = 0; '1-3 times' = 2; '4-10 times' = 7; 'More than 10 times' = 10")

data_gc <- data_gc %>% mutate(ModeTravel_Typical_1 = as.numeric(ModeTravel_Typical_1),
                              ModeTravel_Typical_2 = as.numeric(ModeTravel_Typical_2),
                              ModeTravel_Typical_3 = as.numeric(ModeTravel_Typical_3),
                              ModeTravel_Typical_4 = as.numeric(ModeTravel_Typical_4),
                              ModeTravel_Typical_5 = as.numeric(ModeTravel_Typical_5),
                              ModeTravel_Typical_6 = as.numeric(ModeTravel_Typical_6),
                              ModeTravel_Typical_7 = as.numeric(ModeTravel_Typical_7),
                              ModeTravel_Typical_8 = as.numeric(ModeTravel_Typical_8),
                              ModeTravel_Typical_9 = as.numeric(ModeTravel_Typical_9),
                              ModeTravel_Typical_10 = as.numeric(ModeTravel_Typical_10),
                              ModeTravel_Typical_11 = as.numeric(ModeTravel_Typical_11),
                              ModeTravel_Typical_12 = as.numeric(ModeTravel_Typical_12),
                              ModeTravel_Typical_car = ModeTravel_Typical_1 + ModeTravel_Typical_2,
                              ModeTravel_Typical_PT = ModeTravel_Typical_3 + ModeTravel_Typical_4,
                              ModeTravel_Typical_RH = ModeTravel_Typical_6 + ModeTravel_Typical_7,
                              ModeTravel_Typical_Other = ModeTravel_Typical_5 + ModeTravel_Typical_8 + ModeTravel_Typical_9 + ModeTravel_Typical_10 + ModeTravel_Typical_11 + ModeTravel_Typical_12,
                              ModeTravel_Typical_Total = ModeTravel_Typical_car + ModeTravel_Typical_PT + ModeTravel_Typical_RH + ModeTravel_Typical_Other)
                              

#recode Travel during COVID
data_gc <- data_gc %>% mutate(ModeTravel_CV_1 = as.numeric(Q283_1), #personal car as driver
                              ModeTravel_CV_2 = as.numeric(Q283_2), #personal car as passenger
                              ModeTravel_CV_3 = as.numeric(Q283_3), #bus
                              ModeTravel_CV_4 = as.numeric(Q283_4), #train
                              ModeTravel_CV_5 = as.numeric(Q283_5),
                              ModeTravel_CV_6 = as.numeric(Q283_6), #ride-hailing - private ride (e.g. UberX, Lyft, Taxi)
                              ModeTravel_CV_7 = as.numeric(Q283_7), #ride-hailing - pooled ride (e.g. UberPool Lyft)
                              ModeTravel_CV_8 = as.numeric(Q283_8),
                              ModeTravel_CV_9 = as.numeric(Q283_9),
                              ModeTravel_CV_10 = as.numeric(Q283_10),
                              ModeTravel_CV_11 = as.numeric(Q283_11),
                              ModeTravel_CV_12 = as.numeric(Q283_12),
                              ModeTravel_CV_car = ModeTravel_CV_1 + ModeTravel_CV_2,
                              ModeTravel_CV_PT = ModeTravel_CV_3 + ModeTravel_CV_4,
                              ModeTravel_CV_RH = ModeTravel_CV_6 + ModeTravel_CV_7, 
                              ModeTravel_CV_Other = ModeTravel_CV_5 + ModeTravel_CV_8 + ModeTravel_CV_9 + ModeTravel_CV_10 + ModeTravel_CV_11 + ModeTravel_CV_12,  
                              ModeTravel_CV_Total = ModeTravel_CV_car + ModeTravel_CV_PT + ModeTravel_CV_RH + ModeTravel_CV_Other)

#clean Unable variable to create binary indicators - multiple check boxes response
Unable_options <- c("Driving a car", "Public transit, including bus or train","Bicycle or scooter",
                    "Ride-hailing")
Unable_vars <- c("Car", "PT", "Bicycle", "RH")
# create indicator columns for each action
for (i in 1:length(Unable_options)) {
  data_gc[paste("Unable", Unable_vars[i], sep = "")] <- as.integer(str_detect(data_gc$Unable, Unable_options[i]))
}
# replace NAs with zero
data_gc <- data_gc %>% mutate(UnableCar = ifelse(is.na(UnableCar)==TRUE, 0, UnableCar),
                              UnablePT = ifelse(is.na(UnablePT)==TRUE, 0, UnablePT),
                              UnableBicycle = ifelse(is.na(UnableBicycle)==TRUE, 0, UnableBicycle),
                              UnableRH = ifelse(is.na(UnableRH)==TRUE, 0, UnableRH))
#checked pairwise correlations among the Unable variables;
#  low potential for multicollinearity given highest correlation is 0.67
#650 people unable to use car, 328 unable to use PT, 500 unable to use bike/scooter, and 345 unable to use ridehailing

#clean EmpBen (Employee Benefits) variable to create binary indicators - multiple check boxes response
EmpBen_options <- c("Subsidized or free parking", "Discounted or free transit pass",
                    "Shower, indoor bike parking, or other bike commuting amenities",
                    "Carpooling or other program to encourage taking non-single-occupancy vehicles to work")
EmpBen_vars <- c("Parking", "Transit", "Bike", "Carpool")
# create indicator columns for each action
for (i in 1:length(EmpBen_options)) {
  data_gc[paste("EmpBen", EmpBen_vars[i], sep = "")] <- as.integer(str_detect(data_gc$EmpBen, EmpBen_options[i]))
}
# replace NAs with zero
data_gc <- data_gc %>% mutate(EmpBenParking = ifelse(is.na(EmpBenParking)==TRUE, 0, EmpBenParking),
                              EmpBenTransit = ifelse(is.na(EmpBenTransit)==TRUE, 0, EmpBenTransit),
                              EmpBenBike = ifelse(is.na(EmpBenBike)==TRUE, 0, EmpBenBike),
                              EmpBenCarpool = ifelse(is.na(EmpBenCarpool)==TRUE, 0, EmpBenCarpool))
#checked pairwise correlations among the EmpBen variables;
#  low potential for multicollinearity given highest correlation is 0.25
#273 individuals with bike benefits, 499 with transit benefits, 1162 with parking benefits, and 293 with carpool benefits


summary(as.factor(data_gc$Employ))
data_gc <- data_gc %>% mutate(Unemploy = ifelse(Employ == "Unemployed, looking for work" | Employ == "Unemployed, unable to work or not looking for work" | Employ =="Furloughed, without pay", 1, 0),
                              Student = ifelse(Employ == "Student", 1, 0),
                              Retired = ifelse(Employ == "Retired", 1, 0),
                              FullTime = ifelse(Employ == "Employed, full-time", 1, 0),
                              PartTime = ifelse(Employ == "Employed, part-time", 1, 0),
                              OtherEmp = ifelse(grepl("family worker", Employ) | Employ == "Military" | Employ == "Furloughed, with pay", 1, 0))



# Create Binary Indicators
data_gc <- data_gc %>% mutate(Chicago = ifelse(DMA == "Chicago", 1, 0),
                              Seattle = ifelse(DMA == "Seattle", 1, 0),
                              Dallas = ifelse(DMA == "Dallas", 1, 0),
                              WashingtonDC = ifelse(DMA == "WashingtonDC", 1, 0),
                              Age = as.numeric(Age),
                              Male = ifelse(Gender == "Male", 1, 0),
                              NoCar = ifelse(HHCars == 0, 1, 0),
                              CarOwner = ifelse(HHCars > 0, 1, 0),
                              OneCar = ifelse(HHCars == 1, 1, 0),
                              TwoCar = ifelse(HHCars == 2, 1, 0),
                              ThreeCar = ifelse(HHCars == 3, 1, 0),
                              MultiCar = ifelse(HHCars>1, 1, 0),
                              UsedRH = ifelse(RH_UseInd == "Yes", 1, 0),
                              White = ifelse(grepl("White or Caucasian", Race), 1, 0),
                              Black = ifelse(grepl("Black or African American", Race), 1, 0),
                              Asian = ifelse(grepl("Asian", Race), 1, 0),
                              Native = ifelse(grepl("American Indian or Alaska Native", Race) | grepl("Native Hawaiian or other Pacific Islander", Race), 1, 0),
                              OtherRace = ifelse(grepl("Other", Race), 1, 0),
                              Hispanic = ifelse(Hispanic == "Yes", 1, 0),
                              HSorless = ifelse(Educ == "High school diploma or equivalent (GED)" | Educ == "Less than high school diploma", 1, 0),
                              LessCol = ifelse(Educ == "2+ year college/Associates Degree" | Educ == "Some college, no degree", 1, 0),
                              ColDeg = ifelse(Educ == "4+ year college/Bachelors Degree", 1, 0),
                              MstDeg = ifelse(Educ == "Masters Degree", 1, 0),
                              ProDeg = ifelse(Educ == "Doctoral or Professional degree (PhD, M.D., J.D., etc.)", 1, 0),
                              AdvDeg = MstDeg + ProDeg,
                              License = ifelse(License == "Yes", 1, 0),
                              PTnonuser = ifelse(ModeTravel_Typical_PT == 0, 1, 0),
                              PTinfrequent = ifelse(ModeTravel_Typical_PT > 0 & ModeTravel_Typical_PT <= 5, 1, 0),
                              PTfrequent = ifelse(ModeTravel_Typical_PT > 5 & ModeTravel_Typical_PT <= 10, 1, 0),
                              PTsuperuser = ifelse(ModeTravel_Typical_PT > 10, 1, 0),
                              PCnonuser = ifelse(ModeTravel_Typical_car == 0, 1, 0),
                              PCinfrequent = ifelse(ModeTravel_Typical_car > 0 & ModeTravel_Typical_car <= 5, 1, 0),
                              PCfrequent = ifelse(ModeTravel_Typical_car > 5 & ModeTravel_Typical_car <= 15, 1, 10),
                              PCsuperuser = ifelse(ModeTravel_Typical_car > 15, 1, 0),
                              RHUse_Typical = as.numeric(RHUse_Typical),
                              RHUse_Typical_bin1 = ifelse(RHUse_Typical == 0, 1, 0),
                              RHUse_Typical_bin2 = ifelse(RHUse_Typical %in% 1:3, 1, 0),
                              RHUse_Typical_bin3 = ifelse(RHUse_Typical %in% 4:10, 1, 0),
                              RHUse_Typical_bin4 = ifelse(RHUse_Typical >= 10, 1, 0),
                              HHChild = as.numeric(HHChild),
                              HaveKids = ifelse(HHChild > 0, 1, 0),
                              HHWkAdult = as.numeric(HHWkAdult),
                              EssWkr = ifelse(EssentialWorker=="Yes", 1, 0), 
                              PrevWorkSchool = ifelse(grepl("Did not go to work or school", CV_PrevActions), 1, 0), 
                              PrevBusSubway = ifelse(grepl("Avoided travel on subways or buses", CV_PrevActions), 1, 0),
                              PrevRH = ifelse(grepl("Avoided travel by taxis or ridehailing", CV_PrevActions), 1, 0)
                              
              )

#Work from home capability: Yes, No, or 1655 "NA" that are systematically missing based on answer to "FixedPlace"; did not ask this question for the 491 respondents who say they already worked from home pre-pandemic or the 1164 individuals who were not working/attending school pre-pandemic (retired, unemployed, etc.).

data_gc <- data_gc %>% mutate(WFH_option = ifelse(FixedPlace=="Yes: school and/or work at home", "Yes", WFH_option), 
                                  #replace NAs with "Yes" systematically for those who already work at home
                              WFH = ifelse(WFH_option == "Yes", 1, 0),
                              WFH_nomiss = ifelse(is.na(WFH), 0, WFH))

#Work from home models should exclude those that are unemployed/not working -- so filter by data_gc$FixedPlace != "No: was not employed or going to school", but for the purposes of the preventative action models, we could code WFH as 0 for these individuals so they are not excluded from the analysis

sociodem_vars <- c("ResponseId", "DMA", "WashingtonDC", "Chicago", "Seattle", "Dallas", "Age", "Male", "HHCars", "NoCar", "CarOwner", "OneCar", "TwoCar", "ThreeCar", "MultiCar",  "HHInc.num", "HHInc_bin1", "HHInc_bin2", "HHInc_bin3", "HHInc_bin4", "HHInc_bin5", "White", "Black", "Native", "Asian", "OtherRace", "Hispanic", "HSorless", "LessCol", "ColDeg", "MstDeg", "ProDeg", "AdvDeg", "Unemploy", "Student", "Retired", "FullTime", "PartTime", "OtherEmp", "License", "HHPers", "PTnonuser", "PTinfrequent", "PTfrequent", "PTsuperuser", "PCnonuser", "PCinfrequent", "PCfrequent", "PCsuperuser", "Urban...Suburban...Rural", "Rural", "Urban", "Suburban", "ModeTravel_Typical_PT", "ModeTravel_Typical_car", "ModeTravel_Typical_RH", "ModeTravel_CV_car", "ModeTravel_CV_PT", "ModeTravel_CV_RH", "Car_Livelihood", "RHUse_Typical_bin1", "RHUse_Typical_bin2", "RHUse_Typical_bin3", "RHUse_Typical_bin4",  "HHChild", "HaveKids", "HHWkAdult", "UnableBicycle", "UnableCar", "UnablePT", "UnableRH", "EmpBenParking", "EmpBenTransit", "EmpBenBike", "EmpBenCarpool", "UsedRH", "RHUse_Typical", "PrevWorkSchool", "PrevBusSubway", "PrevRH", "WFH")

```

# Sample Sociodemographics cont.
```{r WFH, warning = FALSE}
sociodem_vars <- data_gc %>% mutate(HHPers_1 = ifelse(HHPers == 1, 1, 0),
                              HHPers_2 = ifelse(HHPers == 2, 1, 0),
                              HHPers_3 = ifelse(HHPers == 3, 1, 0),
                              HHPers_4 = ifelse(HHPers == 4, 1, 0),
                              HHPers_5 = ifelse(HHPers == 5, 1, 0),
                              HHPers_6 = ifelse(HHPers == 6, 1, 0),
                              HHPers_7 = ifelse(HHPers == 7, 1, 0),
                              HHChild = as.numeric(HHChild),
                              HHChild_0 = ifelse(HHChild == 0, 1, 0),
                              HHChild_1 = ifelse(HHChild == 1, 1, 0),
                              HHChild_2 = ifelse(HHChild == 2, 1, 0),
                              HHChild_3 = ifelse(HHChild == 3, 1, 0),
                              HHChild_4 = ifelse(HHChild == 4, 1, 0),
                              HHChild_5 = ifelse(HHChild == 5, 1, 0),
                              HHWkAdult = as.numeric(HHWkAdult),
                              HHWkAdult_0 = ifelse(HHWkAdult == 0, 1, 0),
                              HHWkAdult_1 = ifelse(HHWkAdult == 1, 1, 0),
                              HHWkAdult_2 = ifelse(HHWkAdult == 2, 1, 0),
                              HHWkAdult_3 = ifelse(HHWkAdult == 3, 1, 0),
                              HHWkAdult_4 = ifelse(HHWkAdult == 4, 1, 0),
                              EssWk = ifelse(EssentialWorker == "Yes", 1, 0),
                              WFH = ifelse(WFH_option == "Yes", 1, 0))

WFH_Percep <-  subset(data_gc, select=c("WFH_Perc_before_1", "WFH_Perc_during_1", "WFH_Perc_after_1"))
colnames(WFH_Percep) <- c("Before", "During", "After")
WFH_Percep <- sapply(WFH_Percep[], function(x) as.numeric(as.character(x)))
summary(WFH_Percep) #summary WFH perc before/during/after

WFH_Percep_wide <- melt(WFH_Percep)
```

# Employment based on WFH Perc Before, During, After COVID
```{r WFH, warning = FALSE}
#employment based on WFH Perc Before, During, After COVID

# WFH_Percep_ Before the coronavirus outbreak, what percentage of your work/classroom activities did you conduct remotely? Classroom activities do not include homework.

data_gc$WFH_Perc_before_1 <- as.numeric(data_gc$WFH_Perc_before_1)
data_gc$WFH_Perc_during_1 <- as.numeric(data_gc$WFH_Perc_during_1)
data_gc$WFH_Perc_after_1 <- as.numeric(data_gc$WFH_Perc_after_1)

data_gc$WFH_Change <- (data_gc$WFH_Perc_before_1 - data_gc$WFH_Perc_during_1)
hist(data_gc$WFH_Change)


WFH_Change_Reg <- lm(WFH_Change ~ Age + ColDeg  + Black + Hispanic + Asian + Native + OtherRace + HHWkAdult + HHChild + HHCars + HHInc_bin1 + HHInc_bin2 + HHInc_bin4 + HHInc_bin5 + PartTime + Unemploy + Retired + Student + OtherEmp + HSorless + ColDeg + MstDeg + ProDeg + EssWkr + Chicago + Seattle + Dallas + EmpBenParking + EmpBenTransit + EmpBenBike + EmpBenCarpool, data=data_omit) 
summary(WFH_Change_Reg)

ggplot(data_gc) + geom_bar(aes(x = WFH_Perc_before_1)) + theme_minimal()
ggplot(data_gc) + geom_bar(aes(x = WFH_Perc_during_1)) + theme_minimal()
ggplot(data_gc) + geom_bar(aes(x = WFH_Perc_after_1)) + theme_minimal()
```

# Employment based on WFH Perc Before, During, After COVID Visuals
```{r WFH, warning = FALSE}
# boxplot(data_gc$WFH_Perc_before_1~data_gc$Employ, main = 'WFH Perception before coronavirus based on Employment Status', xlab = '', ylab = 'WFH Perception Before Coronavirus', names = c("Full Time","Part Time", "Contributing Family Worker", "Furloughed with Pay", "Furloughed without Pay", "Unemployed: Looking for Work","Unemployed: NotLooking for Work", "Retired", "Student", "Military") , las=2)
# 
# boxplot(data_gc$WFH_Perc_during_1~data_gc$Employ, main = 'WFH Perception during coronavirus based on Employment Status', xlab = '', ylab = 'WFH Perception During Coronavirus', names = c("Full Time","Part Time", "Contributing Family Worker", "Furloughed with Pay", "Furloughed without Pay", "Unemployed: Looking for Work","Unemployed: NotLooking for Work", "Retired", "Student", "Military") , las=2)
# 
# boxplot(data_gc$WFH_Perc_after_1~data_gc$Employ, main = 'WFH Perception after coronavirus based on Employment Status', xlab = 'Employment Status', ylab = 'WFH Perception After Coronavirus', names = c("Full Time","Part Time", "Contributing Family Worker", "Furloughed with Pay", "Furloughed without Pay", "Unemployed: Looking for Work","Unemployed: NotLooking for Work", "Retired", "Student", "Military") , las=2)

# ggplot(data_gc$WFH_Perc_before_1, aes(x = data_gc$Employ)) + geom_histogram(color="black", fill="white") + labs(title = "Percentage of Remote Activities Before COVID by Employment Status")
# 
# ggplot(data_gc$WFH_Perc_during_1, aes(x = data_gc$Employ)) + geom_histogram(color="black", fill="white") + labs(title = "Percentage of Remote Activities During COVID by Employment Status")
# 
# ggplot(data_gc$WFH_Perc_after_1, aes(x = data_gc$Employ)) + geom_histogram(color="black", fill="white") + labs(title = "Percentage of Remote Activities After COVID by Employment Status")

#Subset into broader categories

data_gc$Employ1[data_gc$Employ == "Employed, full-time"] <- "Full Time"
data_gc$Employ1[data_gc$Employ == "Employed, part-time"] <- "Part Time"
data_gc$Employ1[data_gc$Employ == "Contributing family worker (assist in the operation of family business without receiving regular wages)"] <- "Part Time"
data_gc$Employ1[data_gc$Employ == "Furloughed, with pay"] <- "Furloughed"
data_gc$Employ1[data_gc$Employ == "Furloughed, without pay"] <- "Furloughed"
data_gc$Employ1[data_gc$Employ == "Unemployed, looking for work"] <- "Unemployed"
data_gc$Employ1[data_gc$Employ == "Unemployed, unable to work or not looking for work"] <- "Unemployed"
data_gc$Employ1[data_gc$Employ == "Retired"] <- "Retired"
data_gc$Employ1[data_gc$Employ == "Student"] <- "Student"
data_gc$Employ1[data_gc$Employ == "Military"] <- "Military"

par(mfrow=c(1,3))

boxplot(data_gc$WFH_Perc_before_1~data_gc$Employ1, main = 'Work from Home Perception Before Covid-19 based on Employment Status', xlab = 'Employment Status', ylab = 'WFH Perception Before Coronavirus', names = c("full-time","part-time",  "furlough", "unemp", "retired", "student", "military"), las=1)

boxplot(data_gc$WFH_Perc_during_1~data_gc$Employ1, main = 'Work from Home Perception During Covid-19 based on Employment Status', xlab = 'Employment Status', ylab = 'WFH Perception During Coronavirus', names = c("full-time","part-time",  "furlough", "unemp", "retired", "student", "military"), las=1)

boxplot(data_gc$WFH_Perc_after_1~data_gc$Employ1, main = 'WFH Perception after coronavirus based on Employment Status', xlab = 'Employment Status', ylab = 'WFH Perception After Coronavirus', names = c("full-time","part-time",  "furlough", "unemp", "retired", "student", "military"), las=1)

#look at just full vs. part time

# data_gc$Employ2[data_gc$Employ == "Employed, full-time"] <- "Full Time"
# data_gc$Employ2[data_gc$Employ == "Employed, part-time"] <- "Part Time"
# 
# boxplot(data_gc$WFH_Perc_before_1~data_gc$Employ2, main = 'WFH Perception Full vs. Part Time before coronavirus based on Employment Status', xlab = 'Employment Status', ylab = 'WFH Perception Before Coronavirus', names = c("Full Time","Part Time") , las=2)
# 
# boxplot(data_gc$WFH_Perc_during_1~data_gc$Employ2, main = 'WFH Perception Full vs. Part Time during coronavirus based on Employment Status', xlab = 'Employment Status', ylab = 'WFH Perception During Coronavirus', names = c("Full Time","Part Time") , las=2)
# 
# boxplot(data_gc$WFH_Perc_after_1~data_gc$Employ2, main = 'WFH Perception Full vs. Part Time after coronavirus based on Employment Status', xlab = 'Employment Status', ylab = 'WFH Perception After Coronavirus', names = c("Full Time","Part Time") , las=2)

```

# Logistic Regressions Travel
```{r regression analysis, warning = FALSE}
# Logistic regressions with binary outcome variable =

# (a) selected that they are not going to work or school
NoWorkLogit <- glm(PrevWorkSchool ~ Age + ColDeg  + Black + Hispanic + Asian + Native + OtherRace + HHWkAdult + HHChild + HHCars + HHInc_bin1 + HHInc_bin2 + HHInc_bin4 + HHInc_bin5 + PartTime + Unemploy + Retired + Student + OtherEmp + HSorless + ColDeg + MstDeg + ProDeg + EssWkr + WFH_nomiss + Rural + Urban + Chicago + Seattle + Dallas + EmpBenParking + EmpBenTransit + EmpBenBike + EmpBenCarpool, data=data_gc, family = binomial(link="logit")) 
NoWorkLogit
summary(NoWorkLogit)

# (b) selected that they are avoiding travel by train/bus
AvoidPTLogit <- glm(PrevBusSubway ~ Age + ColDeg  + Black + Hispanic + Asian + Native + OtherRace + HHWkAdult + HHChild + HHCars + HHInc_bin1 + HHInc_bin2 + HHInc_bin4 + HHInc_bin5 + PartTime + Unemploy + Retired + Student + OtherEmp + HSorless + ColDeg + MstDeg + ProDeg + EssWkr + WFH_nomiss + Rural + Urban + Chicago + Seattle + Dallas + EmpBenParking + EmpBenTransit + EmpBenBike + EmpBenCarpool, data=data_gc, family = binomial(link="logit")) 
AvoidPTLogit
summary(AvoidPTLogit)

# (c) selected that they avoided travel by taxi/ridehail
AvoidRHLogit <- glm(PrevRH ~ Age + ColDeg  + Black + Hispanic + Asian + Native + OtherRace + HHWkAdult + HHChild + HHCars + HHInc_bin1 + HHInc_bin2 + HHInc_bin4 + HHInc_bin5 + PartTime + Unemploy + Retired + Student + OtherEmp + HSorless + ColDeg + MstDeg + ProDeg + EssWkr + WFH_nomiss + Rural + Urban + Chicago + Seattle + Dallas + EmpBenParking + EmpBenTransit + EmpBenBike + EmpBenCarpool, data=data_gc, family = binomial(link="logit"))
AvoidRHLogit
summary(AvoidRHLogit)
```

# Logistic Regression Telework capability/ability
```{r regression analysis}
# Telework capability/ability

# Summary statistics 
# Proportion of respondents who say "yes" overall
# WFH_option <- sapply(data_gc$WFH_option[], function(x) as.numeric(as.character(x)))
# summary(WFH_option)

# Separated by city 
# Have not done this yet because predicting not many new observations based on the one I ran below in the subsetted WFH data 

# Logistic regression WFH_Option as dependent variable -- here we should use the variable that excludes individuals that did not work before pandemic
WFHLogit <- glm(WFH_nomiss ~ Age + Male + AdvDeg + HHPers + HHChild + HHCars + Unemploy + PartTime + Retired + Student + OtherEmp + HSorless + ColDeg + MstDeg + ProDeg + EssWkr + HHInc_bin1 + HHInc_bin2 + HHInc_bin4 + HHInc_bin5 + Chicago + Seattle + Dallas + EmpBenParking + EmpBenTransit + EmpBenBike + EmpBenCarpool + Black + Native + Asian + OtherRace + Hispanic + Urban + Rural, data=data_gc, family = binomial(link="logit"))
WFHLogit
summary(WFHLogit)
```

# WFH by City
```{r regression analysis, warning = FALSE}
# Share of Telework

# subset to those wo have the capability/ability to work from home
data_gc_WFH <- data_gc[which(data_gc$WFH_option =='Yes'),]

# Descriptive statistics 
WFH_Percep <-  subset(data_gc_WFH, select=c("WFH_Perc_before_1", "WFH_Perc_during_1", "WFH_Perc_after_1"))
colnames(WFH_Percep) <- c("Before", "During", "After")
WFH_Percep <- sapply(WFH_Percep[], function(x) as.numeric(as.character(x)))

# Summary WFH perc for those who can WFH before/during/after
summary(WFH_Percep)

# Looking at WFH perc by city 

# Dallas
dallas <- filter(data_gc_WFH, DMA == 'Dallas')
WFH_Percep_Dallas <-  subset(dallas, select=c("WFH_Perc_before_1", "WFH_Perc_during_1", "WFH_Perc_after_1"))
colnames(WFH_Percep_Dallas) <- c("Before", "During", "After")
WFH_Percep_Dallas <- sapply(WFH_Percep_Dallas[], function(x) as.numeric(as.character(x)))
summary(WFH_Percep_Dallas)

# Washington DC
washDC <- filter(data_gc_WFH, DMA == 'WashingtonDC')
WFH_Percep_WashDC <-  subset(washDC, select=c("WFH_Perc_before_1", "WFH_Perc_during_1", "WFH_Perc_after_1"))
colnames(WFH_Percep_WashDC) <- c("Before", "During", "After")
WFH_Percep_WashDC <- sapply(WFH_Percep_WashDC[], function(x) as.numeric(as.character(x)))
summary(WFH_Percep_WashDC)

# Seattle 
seattle <- filter(data_gc_WFH, DMA == 'Seattle')
WFH_Percep_Seattle <-  subset(seattle, select=c("WFH_Perc_before_1", "WFH_Perc_during_1", "WFH_Perc_after_1"))
colnames(WFH_Percep_Seattle) <- c("Before", "During", "After")
WFH_Percep_Seattle <- sapply(WFH_Percep_Seattle[], function(x) as.numeric(as.character(x)))
summary(WFH_Percep_Seattle)

# Chicago
chicago <- filter(data_gc_WFH, DMA == 'Chicago')
WFH_Percep_Chicago <-  subset(chicago, select=c("WFH_Perc_before_1", "WFH_Perc_during_1", "WFH_Perc_after_1"))
colnames(WFH_Percep_Chicago) <- c("Before", "During", "After")
WFH_Percep_Chicago <- sapply(WFH_Percep_Chicago[], function(x) as.numeric(as.character(x)))
summary(WFH_Percep_Chicago)
```

# Logistic Regression Lost Employment Covid
```{r additional variables, warning = FALSE}
# Did you lose your employment or become furloughed due to the coronavirus pandemic? (0/1)

data_gc$LoseEmployBin[data_gc$LoseEmploy == 'Yes'] <- 1
data_gc$LoseEmployBin[data_gc$LoseEmploy == 'No'] <- 0

LoseEmployLogit <- glm(LoseEmployBin ~ Age + Male + AdvDeg + HHPers + HHChild + HHCars + Unemploy + HSorless + ColDeg + ProDeg + EssWkr + HHInc_bin1 + HHInc_bin2 + HHInc_bin4 + HHInc_bin5 + Chicago + Seattle + Dallas + EmpBenParking + EmpBenTransit + EmpBenBike + EmpBenCarpool + Black + Native + Asian + OtherRace + Hispanic + Urban + Rural, data=data_gc, family = binomial(link="logit"))
LoseEmployLogit
summary(LoseEmployLogit)
```

# Travel pre/post Covid
```{r additional variables, warning = FALSE}
# Use of other modes pre- and during COVID – “In the past week, how many trips did you make using each of the following transportation modes?

# sum of trips from all transportation PRE covid
data_gc$ModeTravel_Typical_Total
hist(data_gc$ModeTravel_Typical_Total, breaks = c(0,5,10, 15,20,25, 30,35, 40,45, 50, 60, 70, 80, 90,100,200,250,502))
summary(data_gc$ModeTravel_Typical_Total)
boxplot(ModeTravel_Typical_Total)

# sum of trips from all transportation DURING covid
data_gc$ModeTravel_CV_Total
data_gc <- data_gc %>% mutate(ModeTravel_CV_Total = ifelse(ModeTravel_CV_Total>500,500,ModeTravel_CV_Total))
hist(data_gc$ModeTravel_CV_Total,  breaks = c(0,5,10, 15,20,25, 30,35, 40,45, 50, 60, 70, 80, 90,100,200,250,502))
summary(data_gc$ModeTravel_CV_Total)
boxplot(data_gc$ModeTravel_CV_Total)

# change in trips for each individual (pre covid - during covid)
data_gc$ModeTravel_Difference = data_gc$ModeTravel_Typical_Total - data_gc$ModeTravel_CV_Total
hist(data_gc$ModeTravel_Difference)
summary(data_gc$ModeTravel_Difference)

#so if travel during covid is MORE than travel pre-covid, you will get a negative (valid for 3993 responses)
length(which(data_gc$ModeTravel_Difference<0)) #traveled more during COVID 488
length(which(data_gc$ModeTravel_Difference==0)) #same 884
length(which(data_gc$ModeTravel_Difference>0)) #traveled less during COVID 2593

data_gc <- data_gc %>% mutate(ModeTravel_Diff_train = ModeTravel_Typical_4 - ModeTravel_CV_4,
                              ModeTravel_Diff_bus = ModeTravel_Typical_3 - ModeTravel_CV_3,
                              ModeTravel_Diff_cardriver = ModeTravel_Typical_1 - ModeTravel_CV_1, 
                              ModeTravel_Diff_carpassenger = ModeTravel_Typical_2 - ModeTravel_CV_2, 
                              ModeTravel_Diff_rental = ModeTravel_Typical_5 - ModeTravel_CV_5, 
                              ModeTravel_Diff_rhpriv = ModeTravel_Typical_6 - ModeTravel_CV_6, 
                              ModeTravel_Diff_rhpool = ModeTravel_Typical_7 - ModeTravel_CV_7, 
                              ModeTravel_Diff_sharedbike = ModeTravel_Typical_8 - ModeTravel_CV_8, 
                              ModeTravel_Diff_personalbike= ModeTravel_Typical_9 - ModeTravel_CV_9, 
                              ModeTravel_Diff_walk = ModeTravel_Typical_10 - ModeTravel_CV_10, 
                              ModeTravel_Diff_motor = ModeTravel_Typical_11 - ModeTravel_CV_11,
                              ModeTravel_Diff_other = ModeTravel_Typical_12 - ModeTravel_CV_12)

mean(ModeTravel_Diff_train)

hist(data_gc$ModeTravel_Diff_train) # dec
hist(data_gc$ModeTravel_Diff_bus) # dec
hist(data_gc$ModeTravel_Diff_cardriver) # approx half inc half dec
hist(data_gc$ModeTravel_Diff_carpassenger) # dec
hist(data_gc$ModeTravel_Diff_rental) # dec
hist(data_gc$ModeTravel_Diff_rhpriv) # dec
hist(data_gc$ModeTravel_Diff_rhpool) # dec
hist(data_gc$ModeTravel_Diff_sharedbike) # dec
hist(data_gc$ModeTravel_Diff_personalbike) # dec
hist(data_gc$ModeTravel_Diff_walk) # dec
hist(data_gc$ModeTravel_Diff_motor) # dec
hist(data_gc$ModeTravel_Diff_other) # dec

# sum across all individuals for different modes of travel CV
sum(data_gc$ModeTravel_CV_4, na.rm=T)/sum(data_gc$ModeTravel_CV_Total, na.rm=T) # train 0.01618292
sum(data_gc$ModeTravel_CV_3, na.rm=T)/sum(data_gc$ModeTravel_CV_Total, na.rm=T) # bus 0.0220252
sum(data_gc$ModeTravel_CV_1, na.rm=T)/sum(data_gc$ModeTravel_CV_Total, na.rm=T) # cardriver 0.5441531
sum(data_gc$ModeTravel_CV_2, na.rm=T)/sum(data_gc$ModeTravel_CV_Total, na.rm=T) # carpassenger 0.1557816
sum(data_gc$ModeTravel_CV_5, na.rm=T)/sum(data_gc$ModeTravel_CV_Total, na.rm=T) # rental 0.01564162
sum(data_gc$ModeTravel_CV_6, na.rm=T)/sum(data_gc$ModeTravel_CV_Total, na.rm=T) # rhpriv 0.03126458
sum(data_gc$ModeTravel_CV_7, na.rm=T)/sum(data_gc$ModeTravel_CV_Total, na.rm=T) # rhpool 0.0124685
sum(data_gc$ModeTravel_CV_8, na.rm=T)/sum(data_gc$ModeTravel_CV_Total, na.rm=T) # sharedbike 0.008175455
sum(data_gc$ModeTravel_CV_9, na.rm=T)/sum(data_gc$ModeTravel_CV_Total, na.rm=T) # personalbike 0.03363509
sum(data_gc$ModeTravel_CV_10, na.rm=T)/sum(data_gc$ModeTravel_CV_Total, na.rm=T) # walk 0.1529818
sum(data_gc$ModeTravel_CV_11, na.rm=T)/sum(data_gc$ModeTravel_CV_Total, na.rm=T) # motor 0.01661223
sum(data_gc$ModeTravel_CV_12, na.rm=T)/sum(data_gc$ModeTravel_CV_Total, na.rm=T) # other 0.004423705

# sum across all individuals for different modes of travel TYPICAL (expected dec going from here to CV)
sum(data_gc$ModeTravel_Typical_4, na.rm=T)/sum(data_gc$ModeTravel_Typical_Total, na.rm=T) # train 0.03257003 (dec) -0.01638711
sum(data_gc$ModeTravel_Typical_3, na.rm=T)/sum(data_gc$ModeTravel_Typical_Total, na.rm=T) # bus 0.04256323 (dec) -0.02053803
sum(data_gc$ModeTravel_Typical_1, na.rm=T)/sum(data_gc$ModeTravel_Typical_Total, na.rm=T) # cardriver 0.5060615 (INC BY 4%) 0.0380916
sum(data_gc$ModeTravel_Typical_2, na.rm=T)/sum(data_gc$ModeTravel_Typical_Total, na.rm=T) # carpassenger 0.1461104 (INC BY 1%) 0.0096712
sum(data_gc$ModeTravel_Typical_5, na.rm=T)/sum(data_gc$ModeTravel_Typical_Total, na.rm=T) # rental 0.01261815 (~same) 0.00302347
sum(data_gc$ModeTravel_Typical_6, na.rm=T)/sum(data_gc$ModeTravel_Typical_Total, na.rm=T) # rhpriv 0.05379408 (dec) -0.0225295
sum(data_gc$ModeTravel_Typical_7, na.rm=T)/sum(data_gc$ModeTravel_Typical_Total, na.rm=T) # rhpool 0.01866819 (~same) -0.00619969
sum(data_gc$ModeTravel_Typical_8, na.rm=T)/sum(data_gc$ModeTravel_Typical_Total, na.rm=T) # sharedbike 0.009302433 (~same) -0.001126978
sum(data_gc$ModeTravel_Typical_9, na.rm=T)/sum(data_gc$ModeTravel_Typical_Total, na.rm=T) # personalbike 0.02851748 (INC BY 1%) 0.00511761
sum(data_gc$ModeTravel_Typical_10, na.rm=T)/sum(data_gc$ModeTravel_Typical_Total, na.rm=T) # walk 0.147987 (INC BY 1%) 0.0049948
sum(data_gc$ModeTravel_Typical_11, na.rm=T)/sum(data_gc$ModeTravel_Typical_Total, na.rm=T) # motor 0.01096029 (~same) 0.00565194
sum(data_gc$ModeTravel_Typical_12, na.rm=T)/sum(data_gc$ModeTravel_Typical_Total, na.rm=T) # other 0.006216972 (~same) -0.001793267

# visual modes of travel PRE CV
df <- data.frame(
  mode = c('Train', 'Bus', 'Car Driver', 'Car Passenger', 'Rental', 'RH Priv', 'RH Pool', 'Shared Bike', 'Personal Bike', 'Walk', 'Motor', 'Other'),
  count = c(0.03257003, 0.0220252, 0.5441531, 0.1557816, 0.01564162, 0.03126458, 0.01866819, 0.009302433, 0.02851748, 0.147987, 0.01096029, 0.006216972)
  )
head(df)

chart1 <- ggplot(df, aes(x="", y=count, fill=mode)) +
geom_bar(width = 1, stat = "identity")
chart1 + xlab("Before") + ylab("Frequency") + ggtitle("Travel by mode before Covid-19")

#pie1 <- chart1 + coord_polar("y", start=0)
#pie1 + ggtitle("Travel PRE CV") +  xlab("") + ylab("") 

# visual modes of travel CV
df <- data.frame(
  mode = c('Train', 'Bus', 'Car Driver', 'Car Passenger', 'Rental', 'RH Priv', 'RH Pool', 'Shared Bike', 'Personal Bike', 'Walk', 'Motor', 'Other'),
  count = c(0.01618292, 0.04256323, 0.5060615, 0.1461104, 0.01261815, 0.05379408, 0.0124685, 0.008175455, 0.03363509, 0.1529818, 0.01661223, 0.004423705)
  )
head(df)

chart2 <- ggplot(df, aes(x="", y=count, fill=mode)) +
geom_bar(width = 1, stat = "identity")
chart2 + xlab("During") + ylab("Frequency") + ggtitle("Travel by mode during Covid-19")

#pie2 <- chart2 + coord_polar("y", start=0)
#pie2 + ggtitle("Travel CV") +  xlab("") + ylab("") 

grid.arrange(chart1, chart2, ncol=2)
#grid.arrange(pie1, pie2, ncol=2)
```
```{r linear regression, warning = FALSE}
data_omit <- data_gc
na.omit(data_omit)
attach(data_omit)

# ModeTravel_Difference in a linear regression
ModeTravel <- lm(ModeTravel_Difference ~ Age + Male + AdvDeg + HHPers + HHChild + HHCars + Unemploy + PartTime + Retired + Student + OtherEmp + HSorless + ColDeg + MstDeg + EssWkr + Chicago + Seattle + Dallas + Black + Native + Asian + OtherRace + Hispanic + EmpBenParking + EmpBenTransit + EmpBenBike + EmpBenCarpool + PTinfrequent + PTsuperuser + PTnonuser, data=data_omit)
ModeTravel
summary(ModeTravel)

vif(ModeTravel) # all under threshold of 5

AIC.model <- step(ModeTravel, direction="both", trace=0,  steps=1000, k=2)
summary(AIC.model)
plot(AIC.model)

# remove more outliers/influential observations
data_omit <- data_omit[-c(1854, 1355, 107, 1644, 2117),]
ModeTravel_Difference <- ModeTravel_Difference[-c(1854, 1355, 107, 1644, 2117)]
attach(data_omit)

fit.AIC <- lm(ModeTravel_Difference ~ Male  + HHCars + Student + ColDeg + EssWkr + Seattle + Black + EmpBenParking + PTinfrequent + PTsuperuser + PTnonuser, data = data_omit)
plot(fit.AIC)

data_omit <- data_omit[-c(2134, 2783, 3322, 1114, 455),]
ModeTravel_Difference <- ModeTravel_Difference[-c(2134, 2783, 3322, 1114, 455)]
attach(data_omit)

fit.AIC.final <- lm(ModeTravel_Difference ~ Male  + HHCars + Student + ColDeg + EssWkr + Seattle + Black + EmpBenParking + PTinfrequent + PTsuperuser + PTnonuser, data = data_omit)
summary(fit.AIC.final)

set.seed(1)
n <- 4012 #sample size
K <- 5 #5-fold CV as an example
n.fold <- floor(n/K) #size of each fold, rounded down to the nearest integer (so the last fold might be larger in size)
n.shuffle <- sample(1:n, n, replace=FALSE) #shuffle the n indexes
index.fold <- list()
for(i in 1:K)
{
if(i<K)
{
index.fold[[i]] <- n.shuffle[((i-1)*n.fold+1):(i*n.fold)]
}else
{
index.fold[[i]] <- n.shuffle[((K-1)*n.fold+1):n]
}
}

## CANT GET THIS TO WORK FOR SOME REASON 

CV.score <- 0

for(i in 1:K)
{
#fit the full model based on the data excluding the ith fold
fit <- lm(ModeTravel_Difference ~  Male + HHCars + Student + ColDeg + EssWkr + Seattle + Black + EmpBenParking + PTinfrequent + PTsuperuser + PTnonuser, data = data_omit[-index.fold[[i]],])
#make prediction on each observation in the ith fold
pred <- predict(fit,mydata[index.fold[[i]],])
#compute average squared error for the ith fold
CV.score <- CV.score+(1/n)*sum((ModeTravel_Difference[index.fold[[i]]]-pred)^2)
}

CV.score
```

# Travel pre/post Covid Dallas
```{r additional variables, warning = FALSE}
# Separate by city

# DALLAS
dallas <- filter(data_gc, DMA == 'Dallas')

sum(dallas$ModeTravel_CV_4, na.rm=T)/sum(dallas$ModeTravel_CV_Total, na.rm=T) # train 0.009873996
sum(dallas$ModeTravel_CV_3, na.rm=T)/sum(dallas$ModeTravel_CV_Total, na.rm=T) # bus 0.01156879
sum(dallas$ModeTravel_CV_1, na.rm=T)/sum(dallas$ModeTravel_CV_Total, na.rm=T) # cardriver 0.633041
sum(dallas$ModeTravel_CV_2, na.rm=T)/sum(dallas$ModeTravel_CV_Total, na.rm=T) # carpassenger 0.1587208
sum(dallas$ModeTravel_CV_5, na.rm=T)/sum(dallas$ModeTravel_CV_Total, na.rm=T) # rental 0.007147594
sum(dallas$ModeTravel_CV_6, na.rm=T)/sum(dallas$ModeTravel_CV_Total, na.rm=T) # rhpriv 0.03028517
sum(dallas$ModeTravel_CV_7, na.rm=T)/sum(dallas$ModeTravel_CV_Total, na.rm=T) # rhpool 0.01105298
sum(dallas$ModeTravel_CV_8, na.rm=T)/sum(dallas$ModeTravel_CV_Total, na.rm=T) # sharedbike 0.007516027
sum(dallas$ModeTravel_CV_9, na.rm=T)/sum(dallas$ModeTravel_CV_Total, na.rm=T) # personalbike 0.02564292
sum(dallas$ModeTravel_CV_10, na.rm=T)/sum(dallas$ModeTravel_CV_Total, na.rm=T) # walk 0.1051507
sum(dallas$ModeTravel_CV_11, na.rm=T)/sum(dallas$ModeTravel_CV_Total, na.rm=T) # motor 0.01716896
sum(dallas$ModeTravel_CV_12, na.rm=T)/sum(dallas$ModeTravel_CV_Total, na.rm=T) # other 0.003021148

# sum across all individuals for different modes of travel TYPICAL (expected dec going from here to CV)
sum(dallas$ModeTravel_Typical_4, na.rm=T)/sum(dallas$ModeTravel_Typical_Total, na.rm=T) # train 0.01546272
sum(dallas$ModeTravel_Typical_3, na.rm=T)/sum(dallas$ModeTravel_Typical_Total, na.rm=T) # bus 0.02063248
sum(dallas$ModeTravel_Typical_1, na.rm=T)/sum(dallas$ModeTravel_Typical_Total, na.rm=T) # cardriver 0.5963858
sum(dallas$ModeTravel_Typical_2, na.rm=T)/sum(dallas$ModeTravel_Typical_Total, na.rm=T) # carpassenger 0.1387453
sum(dallas$ModeTravel_Typical_5, na.rm=T)/sum(dallas$ModeTravel_Typical_Total, na.rm=T) # rental 0.01397233
sum(dallas$ModeTravel_Typical_6, na.rm=T)/sum(dallas$ModeTravel_Typical_Total, na.rm=T) # rhpriv 0.05258255
sum(dallas$ModeTravel_Typical_7, na.rm=T)/sum(dallas$ModeTravel_Typical_Total, na.rm=T) # rhpool 0.01769829
sum(dallas$ModeTravel_Typical_8, na.rm=T)/sum(dallas$ModeTravel_Typical_Total, na.rm=T) # sharedbike 0.008662848
sum(dallas$ModeTravel_Typical_9, na.rm=T)/sum(dallas$ModeTravel_Typical_Total, na.rm=T) # personalbike 0.0253365
sum(dallas$ModeTravel_Typical_10, na.rm=T)/sum(dallas$ModeTravel_Typical_Total, na.rm=T) # walk 0.09538447
sum(dallas$ModeTravel_Typical_11, na.rm=T)/sum(dallas$ModeTravel_Typical_Total, na.rm=T) # motor 0.01210936
sum(dallas$ModeTravel_Typical_12, na.rm=T)/sum(dallas$ModeTravel_Typical_Total, na.rm=T) # other 0.008383401

# visual modes of travel PRE CV
df <- data.frame(
  mode = c('Train', 'Bus', 'Car Driver', 'Car Passenger', 'Rental', 'RH Priv', 'RH Pool', 'Shared Bike', 'Personal Bike', 'Walk', 'Motor', 'Other'),
  count = c(0.009873996, 0.01156879, 0.633041, 0.1587208, 0.007147594, 0.03028517, 0.01105298, 0.007516027, 0.02564292, 0.1051507, 0.01716896, 0.003021148)
  )
head(df)

chart1dallas <- ggplot(df, aes(x="", y=count, fill=mode)) +
geom_bar(width = 1, stat = "identity")
chart1dallas + xlab(" ") + ylab("Count") + ggtitle("Travel PRE CV DALLAS")

pie1dallas <- chart1dallas + coord_polar("y", start=0)
pie1dallas + ggtitle("Travel PRE CV") +  xlab("") + ylab("") 

# visual modes of travel CV
df <- data.frame(
  mode = c('Train', 'Bus', 'Car Driver', 'Car Passenger', 'Rental', 'RH Priv', 'RH Pool', 'Shared Bike', 'Personal Bike', 'Walk', 'Motor', 'Other'),
  count = c(0.01546272, 0.02063248, 0.5963858, 0.1387453, 0.01397233, 0.05258255, 0.01769829, 0.008662848, 0.0253365, 0.09538447, 0.01210936, 0.008383401)
  )
head(df)

chart2dallas <- ggplot(df, aes(x="", y=count, fill=mode)) +
geom_bar(width = 1, stat = "identity")
chart2dallas + xlab(" ") + ylab("Count") + ggtitle("Travel CV DALLAS")

pie2dallas <- chart2dallas + coord_polar("y", start=0)
pie2dallas + ggtitle("Travel CV") +  xlab("") + ylab("") 

grid.arrange(chart1dallas, chart2dallas, ncol=2)
grid.arrange(pie1dallas, pie2dallas, ncol=2)
```

# Travel pre/post Covid Chicago
```{r additional variables, warning = FALSE}
# Separate by city

# CHICAGO
chi <- filter(data_gc, DMA == 'Chicago')

sum(chi$ModeTravel_CV_4, na.rm=T)/sum(chi$ModeTravel_CV_Total, na.rm=T) # train 
sum(chi$ModeTravel_CV_3, na.rm=T)/sum(chi$ModeTravel_CV_Total, na.rm=T) # bus 
sum(chi$ModeTravel_CV_1, na.rm=T)/sum(chi$ModeTravel_CV_Total, na.rm=T) # cardriver 
sum(chi$ModeTravel_CV_2, na.rm=T)/sum(chi$ModeTravel_CV_Total, na.rm=T) # carpassenger 
sum(chi$ModeTravel_CV_5, na.rm=T)/sum(chi$ModeTravel_CV_Total, na.rm=T) # rental 
sum(chi$ModeTravel_CV_6, na.rm=T)/sum(chi$ModeTravel_CV_Total, na.rm=T) # rhpriv 
sum(chi$ModeTravel_CV_7, na.rm=T)/sum(chi$ModeTravel_CV_Total, na.rm=T) # rhpool 
sum(chi$ModeTravel_CV_8, na.rm=T)/sum(chi$ModeTravel_CV_Total, na.rm=T) # sharedbike 
sum(chi$ModeTravel_CV_9, na.rm=T)/sum(chi$ModeTravel_CV_Total, na.rm=T) # personalbike 
sum(chi$ModeTravel_CV_10, na.rm=T)/sum(chi$ModeTravel_CV_Total, na.rm=T) # walk 
sum(chi$ModeTravel_CV_11, na.rm=T)/sum(chi$ModeTravel_CV_Total, na.rm=T) # motor 
sum(chi$ModeTravel_CV_12, na.rm=T)/sum(chi$ModeTravel_CV_Total, na.rm=T) # other 

# sum across all individuals for different modes of travel TYPICAL (expected dec going from here to CV)
sum(chi$ModeTravel_Typical_4, na.rm=T)/sum(chi$ModeTravel_Typical_Total, na.rm=T) # train 
sum(chi$ModeTravel_Typical_3, na.rm=T)/sum(chi$ModeTravel_Typical_Total, na.rm=T) # bus 
sum(chi$ModeTravel_Typical_1, na.rm=T)/sum(chi$ModeTravel_Typical_Total, na.rm=T) # cardriver 
sum(chi$ModeTravel_Typical_2, na.rm=T)/sum(chi$ModeTravel_Typical_Total, na.rm=T) # carpassenger 
sum(chi$ModeTravel_Typical_5, na.rm=T)/sum(chi$ModeTravel_Typical_Total, na.rm=T) # rental 
sum(chi$ModeTravel_Typical_6, na.rm=T)/sum(chi$ModeTravel_Typical_Total, na.rm=T) # rhpriv 
sum(chi$ModeTravel_Typical_7, na.rm=T)/sum(chi$ModeTravel_Typical_Total, na.rm=T) # rhpool 
sum(chi$ModeTravel_Typical_8, na.rm=T)/sum(chi$ModeTravel_Typical_Total, na.rm=T) # sharedbike 
sum(chi$ModeTravel_Typical_9, na.rm=T)/sum(chi$ModeTravel_Typical_Total, na.rm=T) # personalbike 
sum(chi$ModeTravel_Typical_10, na.rm=T)/sum(chi$ModeTravel_Typical_Total, na.rm=T) # walk 
sum(chi$ModeTravel_Typical_11, na.rm=T)/sum(chi$ModeTravel_Typical_Total, na.rm=T) # motor 
sum(chi$ModeTravel_Typical_12, na.rm=T)/sum(chi$ModeTravel_Typical_Total, na.rm=T) # other 

# visual modes of travel PRE CV
df <- data.frame(
  mode = c('Train', 'Bus', 'Car Driver', 'Car Passenger', 'Rental', 'RH Priv', 'RH Pool', 'Shared Bike', 'Personal Bike', 'Walk', 'Motor', 'Other'),
  count = c(0.02117949, 0.01604507, 0.5222848, 0.1544605, 0.02132211, 0.02467375, 0.0149754, 0.007630322, 0.04200242, 0.1667261, 0.01319261, 0.003565571)
  )
head(df)

chart1chi <- ggplot(df, aes(x="", y=count, fill=mode)) +
geom_bar(width = 1, stat = "identity")
chart1chi + xlab(" ") + ylab("Count") + ggtitle("Travel PRE CV CHICAGO")

pie1chi <- chart1chi + coord_polar("y", start=0)
pie1chi + ggtitle("Travel PRE CV") +  xlab("") + ylab("") 

# visual modes of travel CV
df <- data.frame(
  mode = c('Train', 'Bus', 'Car Driver', 'Car Passenger', 'Rental', 'RH Priv', 'RH Pool', 'Shared Bike', 'Personal Bike', 'Walk', 'Motor', 'Other'),
  count = c(0.04805065, 0.03751247, 0.4681469, 0.1521315, 0.01006115, 0.05052257, 0.01530856, 0.004727005, 0.03165792, 0.1747257, 0.008456568, 0.004553537)
  )
head(df)

chart2chi <- ggplot(df, aes(x="", y=count, fill=mode)) +
geom_bar(width = 1, stat = "identity")
chart2chi + xlab(" ") + ylab("Count") + ggtitle("Travel CV CHICAGO")

pie2chi <- chart2chi + coord_polar("y", start=0)
pie2chi + ggtitle("Travel CV") +  xlab("") + ylab("") 

grid.arrange(chart1chi, chart2chi, ncol=2)
grid.arrange(pie1chi, pie2chi, ncol=2)
```

# Travel pre/post Covid Seattle
```{r additional variables, warning = FALSE}
# Separate by city

# SEATTLE
seattle <- filter(data_gc, DMA == 'Seattle')

sum(seattle$ModeTravel_CV_4, na.rm=T)/sum(seattle$ModeTravel_CV_Total, na.rm=T) # train 
sum(seattle$ModeTravel_CV_3, na.rm=T)/sum(seattle$ModeTravel_CV_Total, na.rm=T) # bus 
sum(seattle$ModeTravel_CV_1, na.rm=T)/sum(seattle$ModeTravel_CV_Total, na.rm=T) # cardriver 
sum(seattle$ModeTravel_CV_2, na.rm=T)/sum(seattle$ModeTravel_CV_Total, na.rm=T) # carpassenger 
sum(seattle$ModeTravel_CV_5, na.rm=T)/sum(seattle$ModeTravel_CV_Total, na.rm=T) # rental 
sum(seattle$ModeTravel_CV_6, na.rm=T)/sum(seattle$ModeTravel_CV_Total, na.rm=T) # rhpriv 
sum(seattle$ModeTravel_CV_7, na.rm=T)/sum(seattle$ModeTravel_CV_Total, na.rm=T) # rhpool 
sum(seattle$ModeTravel_CV_8, na.rm=T)/sum(seattle$ModeTravel_CV_Total, na.rm=T) # sharedbike 
sum(seattle$ModeTravel_CV_9, na.rm=T)/sum(seattle$ModeTravel_CV_Total, na.rm=T) # personalbike 
sum(seattle$ModeTravel_CV_10, na.rm=T)/sum(seattle$ModeTravel_CV_Total, na.rm=T) # walk 
sum(seattle$ModeTravel_CV_11, na.rm=T)/sum(seattle$ModeTravel_CV_Total, na.rm=T) # motor 
sum(seattle$ModeTravel_CV_12, na.rm=T)/sum(seattle$ModeTravel_CV_Total, na.rm=T) # other 

# sum across all individuals for different modes of travel TYPICAL (expected dec going from here to CV)
sum(seattle$ModeTravel_Typical_4, na.rm=T)/sum(seattle$ModeTravel_Typical_Total, na.rm=T) # train 
sum(seattle$ModeTravel_Typical_3, na.rm=T)/sum(seattle$ModeTravel_Typical_Total, na.rm=T) # bus 
sum(seattle$ModeTravel_Typical_1, na.rm=T)/sum(seattle$ModeTravel_Typical_Total, na.rm=T) # cardriver 
sum(seattle$ModeTravel_Typical_2, na.rm=T)/sum(seattle$ModeTravel_Typical_Total, na.rm=T) # carpassenger 
sum(seattle$ModeTravel_Typical_5, na.rm=T)/sum(seattle$ModeTravel_Typical_Total, na.rm=T) # rental 
sum(seattle$ModeTravel_Typical_6, na.rm=T)/sum(seattle$ModeTravel_Typical_Total, na.rm=T) # rhpriv 
sum(seattle$ModeTravel_Typical_7, na.rm=T)/sum(seattle$ModeTravel_Typical_Total, na.rm=T) # rhpool 
sum(seattle$ModeTravel_Typical_8, na.rm=T)/sum(seattle$ModeTravel_Typical_Total, na.rm=T) # sharedbike 
sum(seattle$ModeTravel_Typical_9, na.rm=T)/sum(seattle$ModeTravel_Typical_Total, na.rm=T) # personalbike 
sum(seattle$ModeTravel_Typical_10, na.rm=T)/sum(seattle$ModeTravel_Typical_Total, na.rm=T) # walk 
sum(seattle$ModeTravel_Typical_11, na.rm=T)/sum(seattle$ModeTravel_Typical_Total, na.rm=T) # motor 
sum(seattle$ModeTravel_Typical_12, na.rm=T)/sum(seattle$ModeTravel_Typical_Total, na.rm=T) # other 

# visual modes of travel PRE CV
df <- data.frame(
  mode = c('Train', 'Bus', 'Car Driver', 'Car Passenger', 'Rental', 'RH Priv', 'RH Pool', 'Shared Bike', 'Personal Bike', 'Walk', 'Motor', 'Other'),
  count = c(0.01310452, 0.02090484, 0.5432917, 0.1636505, 0.008346334, 0.02527301, 0.007020281, 0.005694228, 0.02839314, 0.1712949, 0.01053042, 0.003822153)
  )
head(df)

chart1seattle <- ggplot(df, aes(x="", y=count, fill=mode)) +
geom_bar(width = 1, stat = "identity")
chart1seattle + xlab(" ") + ylab("Count") + ggtitle("Travel PRE CV CHICAGO")

pie1seattle <- chart1seattle + coord_polar("y", start=0)
pie1seattle + ggtitle("Travel PRE CV") +  xlab("") + ylab("") 

# visual modes of travel CV
df <- data.frame(
  mode = c('Train', 'Bus', 'Car Driver', 'Car Passenger', 'Rental', 'RH Priv', 'RH Pool', 'Shared Bike', 'Personal Bike', 'Walk', 'Motor', 'Other'),
  count = c(0.02157876, 0.05881467, 0.505194, 0.1555176, 0.006875094, 0.03748683, 0.01796557, 0.006573995, 0.02383701, 0.1599338, 0.007928941, 0.007075827)
  )
head(df)

chart2seattle <- ggplot(df, aes(x="", y=count, fill=mode)) +
geom_bar(width = 1, stat = "identity")
chart2seattle + xlab(" ") + ylab("Count") + ggtitle("Travel CV CHICAGO")

pie2seattle <- chart2seattle + coord_polar("y", start=0)
pie2seattle + ggtitle("Travel CV") +  xlab("") + ylab("") 

grid.arrange(chart1seattle, chart2seattle, ncol=2)
grid.arrange(pie1seattle, pie2seattle, ncol=2)
```

# Travel pre/post Covid Washington DC
```{r additional variables, warning = FALSE}
# Separate by city

# WASHINGTON DC
washDC <- filter(data_gc, DMA == 'WashingtonDC')

sum(washDC$ModeTravel_CV_4, na.rm=T)/sum(washDC$ModeTravel_CV_Total, na.rm=T) # train 
sum(washDC$ModeTravel_CV_3, na.rm=T)/sum(washDC$ModeTravel_CV_Total, na.rm=T) # bus 
sum(washDC$ModeTravel_CV_1, na.rm=T)/sum(washDC$ModeTravel_CV_Total, na.rm=T) # cardriver 
sum(washDC$ModeTravel_CV_2, na.rm=T)/sum(washDC$ModeTravel_CV_Total, na.rm=T) # carpassenger 
sum(washDC$ModeTravel_CV_5, na.rm=T)/sum(washDC$ModeTravel_CV_Total, na.rm=T) # rental 
sum(washDC$ModeTravel_CV_6, na.rm=T)/sum(washDC$ModeTravel_CV_Total, na.rm=T) # rhpriv 
sum(washDC$ModeTravel_CV_7, na.rm=T)/sum(washDC$ModeTravel_CV_Total, na.rm=T) # rhpool 
sum(washDC$ModeTravel_CV_8, na.rm=T)/sum(washDC$ModeTravel_CV_Total, na.rm=T) # sharedbike 
sum(washDC$ModeTravel_CV_9, na.rm=T)/sum(washDC$ModeTravel_CV_Total, na.rm=T) # personalbike 
sum(washDC$ModeTravel_CV_10, na.rm=T)/sum(washDC$ModeTravel_CV_Total, na.rm=T) # walk 
sum(washDC$ModeTravel_CV_11, na.rm=T)/sum(washDC$ModeTravel_CV_Total, na.rm=T) # motor 
sum(washDC$ModeTravel_CV_12, na.rm=T)/sum(washDC$ModeTravel_CV_Total, na.rm=T) # other 

# sum across all individuals for different modes of travel TYPICAL (expected dec going from here to CV)
sum(washDC$ModeTravel_Typical_4, na.rm=T)/sum(washDC$ModeTravel_Typical_Total, na.rm=T) # train 
sum(washDC$ModeTravel_Typical_3, na.rm=T)/sum(washDC$ModeTravel_Typical_Total, na.rm=T) # bus 
sum(washDC$ModeTravel_Typical_1, na.rm=T)/sum(washDC$ModeTravel_Typical_Total, na.rm=T) # cardriver 
sum(washDC$ModeTravel_Typical_2, na.rm=T)/sum(washDC$ModeTravel_Typical_Total, na.rm=T) # carpassenger 
sum(washDC$ModeTravel_Typical_5, na.rm=T)/sum(washDC$ModeTravel_Typical_Total, na.rm=T) # rental 
sum(washDC$ModeTravel_Typical_6, na.rm=T)/sum(washDC$ModeTravel_Typical_Total, na.rm=T) # rhpriv 
sum(washDC$ModeTravel_Typical_7, na.rm=T)/sum(washDC$ModeTravel_Typical_Total, na.rm=T) # rhpool 
sum(washDC$ModeTravel_Typical_8, na.rm=T)/sum(washDC$ModeTravel_Typical_Total, na.rm=T) # sharedbike 
sum(washDC$ModeTravel_Typical_9, na.rm=T)/sum(washDC$ModeTravel_Typical_Total, na.rm=T) # personalbike 
sum(washDC$ModeTravel_Typical_10, na.rm=T)/sum(washDC$ModeTravel_Typical_Total, na.rm=T) # walk 
sum(washDC$ModeTravel_Typical_11, na.rm=T)/sum(washDC$ModeTravel_Typical_Total, na.rm=T) # motor 
sum(washDC$ModeTravel_Typical_12, na.rm=T)/sum(washDC$ModeTravel_Typical_Total, na.rm=T) # other 

# visual modes of travel PRE CV
df <- data.frame(
  mode = c('Train', 'Bus', 'Car Driver', 'Car Passenger', 'Rental', 'RH Priv', 'RH Pool', 'Shared Bike', 'Personal Bike', 'Walk', 'Motor', 'Other'),
  count = c(0.02036319, 0.0402705, 0.4766355, 0.1464934, 0.02545399, 0.04513335, 0.01656409, 0.0118532, 0.03806702, 0.1698199, 0.02560596, 0.007370261)
  )
head(df)

chart1wash <- ggplot(df, aes(x="", y=count, fill=mode)) +
geom_bar(width = 1, stat = "identity")
chart1wash + xlab(" ") + ylab("Count") + ggtitle("Travel PRE CV CHICAGO")

pie1wash <- chart1wash + coord_polar("y", start=0)
pie1wash + ggtitle("Travel PRE CV") +  xlab("") + ylab("") 

# visual modes of travel CV
df <- data.frame(
  mode = c('Train', 'Bus', 'Car Driver', 'Car Passenger', 'Rental', 'RH Priv', 'RH Pool', 'Shared Bike', 'Personal Bike', 'Walk', 'Motor', 'Other'),
  count = c(0.04280868, 0.05432551, 0.4592893, 0.1386037, 0.0190608, 0.07282832, 0.02368092, 0.01705205, 0.0324971, 0.1602535, 0.01513258, 0.005088831)
  )
head(df)

chart2wash <- ggplot(df, aes(x="", y=count, fill=mode)) +
geom_bar(width = 1, stat = "identity")
chart2wash + xlab(" ") + ylab("Count") + ggtitle("Travel CV CHICAGO")

pie2wash <- chart2wash + coord_polar("y", start=0)
pie2wash + ggtitle("Travel CV") +  xlab("") + ylab("") 

grid.arrange(chart1wash, chart2wash, ncol=2)
grid.arrange(pie1wash, pie2wash, ncol=2)
```

# Travel pre/post Covid by City (all 4)
```{r additional variables, warning = FALSE}
# all four separated by city side by side 

grid.arrange(chart1dallas, chart1chi, chart1seattle, chart1wash, ncol=2) # pre cv 
grid.arrange(chart2dallas, chart2chi, chart2seattle, chart2wash, ncol=2) # post cv

grid.arrange(chart1dallas, chart2dallas, ncol=2) # dallas dc pre and post
grid.arrange(chart1chi, chart2chi, ncol=2) # chicago pre and post
grid.arrange(chart1seattle, chart2seattle, ncol=2) # seattle pre and post
grid.arrange(chart1wash, chart2wash, ncol=2) # washington dc pre and post
```

# Change in weekly trips violin plot
```{r additional variables, warning = FALSE}
# violin plots 
# x - mode 
# y - change in number of weekly trips pre vs. during covid
df <- data.frame(
  mode = c('Train', 'Bus', 'Car Driver', 'Car Passenger', 'Rental', 'RH Priv', 'RH Pool', 'Shared Bike', 'Personal Bike', 'Walk', 'Motor', 'Other'),
  diff = c(data_gc$ModeTravel_Diff_train, data_gc$ModeTravel_Diff_bus, data_gc$ModeTravel_Diff_cardriver, data_gc$ModeTravel_Diff_carpassenger, data_gc$ModeTravel_Diff_rental, data_gc$ModeTravel_Diff_rhpriv, data_gc$ModeTravel_Diff_rhpool, data_gc$ModeTravel_Diff_sharedbike, data_gc$ModeTravel_Diff_personalbike, data_gc$ModeTravel_Diff_walk, data_gc$ModeTravel_Diff_motor, data_gc$ModeTravel_Diff_other)
  )
head(df)

p <- ggplot(df, aes(x=mode, y=diff)) + 
  geom_violin(trim = FALSE) + ylab("Change in Number of Weekly Trips") + xlab("Mode of Travel") + theme(axis.text.x = element_text(angle = 90)) + ggtitle("Change in Weekly Trips Before vs. During Covid-19 by Travel Mode")
p + coord_flip()
```




